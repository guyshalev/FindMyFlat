(function(){if(window.guidanceViewerInited){return}window.guidanceViewerInited=true;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return}if((window.attachEvent&&!window.addEventListener)||!Object.create){return}if(!window.serverUrl){throw new Error("serverUrl variable is missing in Guidance code");return}if(!window.guidanceAccount){throw new Error("guidanceAccount variable is missing in Guidance code");return}var EventEmitter=function(){this.events={}};EventEmitter.prototype.on=function(name,callback){var evt=this.events[name];if(!evt){evt=this.events[name]=[]}evt.push(callback)};EventEmitter.prototype.off=function(name,callback){var evt=this.events[name];if(!evt){return}for(var i=0;i<evt.length;++i){if(evt[i]!==callback){continue}evt.splice(i,1);return}};EventEmitter.prototype.emit=function(name,args){var evt=this.events[name];if(!evt||!evt.length){return}var evtArgs=[];for(var i=1;i<arguments.length;++i){evtArgs.push(arguments[i])}for(var i=0;i<evt.length;++i){evt[i].apply(this,evtArgs)}};EventEmitter.prototype.once=function(name,callback){this.on(name,function(){this.off(name,arguments.callee);callback.apply(this,arguments)})};(function(){var head=document.head||document.getElementsByTagName("head")[0];var container={};var utils={findObject:findObject,Modular:Modular};var bundleManager=findObject("nanoRep.BundleManager",true);function findObject(path,force,current){var pos=0,len,next;path=path.split(".");current=current||window;len=path.length;while((pos<len)&&(typeof current==="object"||typeof current==="function")){next=current[path[pos]];if(!(typeof next==="object"||typeof next==="function")){break}current=next;++pos}if(force){while(pos<len){next={};current[path[pos]]=next;current=next;++pos}}return((pos<len)?null:current)}function Modular(bundleInstance){this.bundleInstance=bundleInstance;this.defined={};this.exportMode=false}Modular.prototype.declare=function(name,deps){var pos,len,dep;this.name=name;this.deps=[];for(pos=0,len=deps?deps.length:0;pos<len;++pos){dep=deps[pos];
if(typeof dep==="string"){dep=this.defined[dep]}this.deps.push(dep)}};Modular.prototype.define=function(fCreate){var instance=fCreate.apply(null,this.deps);if(instance){this.defined[this.name]=instance;if(this.exportMode){this.bundleInstance[this.name]=instance}}};Modular.prototype.startExport=function(){this.exportMode=true};Modular.prototype.endExport=function(){this.exportMode=false};Modular.prototype.byName=function(name){return this.defined[name]};utils.objectFinder=function(path,current){return function(){return findObject(path,false,current)}};utils.addStyle=function(){var style=document.createElement("style"),text=Array.prototype.join.call(arguments,"\n"),tmpLoadHandler;style.setAttribute("type","text/css");if(style.styleSheet){style.styleSheet.cssText=text;if(document.body){head.appendChild(style)}else{if(document.addEventListener){tmpLoadHandler=function(){document.removeEventListener("DOMContentLoaded",tmpLoadHandler,false);head.appendChild(style)};document.addEventListener("DOMContentLoaded",tmpLoadHandler,false)}else{if(window.attachEvent){tmpLoadHandler=function(){window.detachEvent("onload",tmpLoadHandler);head.appendChild(style)};window.attachEvent("onload",tmpLoadHandler)}}}}else{style.appendChild(document.createTextNode(text));head.appendChild(style)}return style};bundleManager.updateIndex=function(){return this};bundleManager.define=function(bundle){var name=bundle.name,instance,reason;if(container.hasOwnProperty(name)){reason=["Redefinition of '",name,"' bundle!"].join("");throw (new Error(reason))}instance=(bundle.hasOwnProperty("ns")?findObject(bundle.ns,true):{});container[name]=instance;bundle.init.call(instance,container,bundle.data,utils);return this};bundleManager.findObject=findObject;window.ISQ=nanoRep}());nanoRep.BundleManager.define({name:"Common.Guidance",require:[],data:{css:".nanoGuidance{position:absolute;background:#fff;border:1px solid #ccc;padding:10px;#width:300px;min-width:90px;max-width:300px;height:auto;top:0;left:0;display:none;z-index:2000}\n.nanoGuidance .triangle{width:0;height:0;border:20px solid transparent;position:absolute;z-index:2010}\n.nanoGuidance .triangleBorder{width:0;height:0;border:18px solid transparent;position:absolute}\n.nanoGuidance.positionRight .triangle{top:calc(50% - 20px);left:-36px;right:auto;bottom:auto;border-right:16px solid #fff}\n.nanoGuidance.positionRight .triangleBorder{top:calc(50% - 27px);left:-36px;right:auto;bottom:auto;border-right:16px solid #ccc}\n.nanoGuidance.positionLeft .triangle{top:calc(50% - 27px);right:-36px;left:auto;bottom:auto;border-left:16px solid #fff}\n.nanoGuidance.positionLeft .triangleBorder{right:-36px;top:5px;left:auto;bottom:auto;border-left:18px solid #ccc}\n.nanoGuidance.positionBottom .triangle{left:calc(50% - 20px);top:-36px;border-bottom:16px solid #fff}\n.nanoGuidance.positionBottom .triangleBorder{left:5px;top:-36px;border-bottom:18px solid #ccc}\n.nanoGuidance.positionAbove .triangle{left:calc(50% - 20px);bottom:-36px;border-top:16px solid #fff}\n.nanoGuidance.positionAbove .triangleBorder{left:5px;bottom:-36px;border-top:16px solid #ccc}\n.nanoGuidance .currentText{font-size:14px;margin-bottom:10px;padding-right:10px}\n.nanoGuidance.fixed{left:50%;top:50%;position:fixed}.nanoGuidance .stopGuide{position:absolute;right:2px;top:2px;color:#555;font-size:14px;width:14px;height:14px;cursor:pointer;font-family:monospace;line-height:14px;text-align:center}\n.nanoGuidance .stepsPoint{width:8px;height:8px;border:1px solid #555;border-radius:5px;float:left;margin-right:5px;margin-top:7px;background:#fff}\n.nanoGuidance .stepsPoint.active{background:#888}.nanoGuidance a.next{font-size:14px;background:#888;color:#fff;width:56px;height:25px;line-height:25px;display:block;text-align:center;text-decoration:none;float:right;cursor:pointer}\n.nanoGuidance a.prev{font-size:14px;background:#888;color:#fff;width:56px;height:25px;line-height:25px;display:block;text-align:center;text-decoration:none;float:left;cursor:pointer}\n.nanoGuidanceOverlay{z-index:1999;position:absolute;background:#555;opacity:.5;left:0;top:0;width:100%}\ndiv.curve{position:absolute;top:150px;left:400px;background:#666;width:200px;height:200px}\n.nanoGuidance{background:#444;border:0;padding:40px 30px 30px 30px;border-radius:5px}\n.nanoGuidance .stopGuide{color:#fff;right:10px;top:10px;font-size:12px}.nanoGuidance .currentText{font-family:'Open Sans',Arial;font-size:16px;line-height:21px;color:#fff;text-align:left;font-weight:300;min-height:25px;padding-bottom:38px}\n.nanoGuidance a.next{width:90px;height:40px;line-height:40px;background:#00bfbc;border-radius:3px;position:absolute;right:30px;bottom:20px}\n.nanoGuidance .stepsInidicator{height:10px;position:absolute;bottom:10px;left:0;width:100%;text-align:center;line-height:10px}\n.nanoGuidance .stepsPoint{background:#fff;display:inline-block;float:none;width:10px;height:10px;border:0;margin-top:0}\n.nanoGuidance .stepsPoint.active{background:#00bfbc}.nanoGuidance.positionBottom .triangle{border-bottom-color:#444}\n.nanoGuidance.positionAbove .triangle{border-top-color:#444}.nanoGuidance.positionLeft .triangle{border-left-color:#444}\n.nanoGuidance.positionRight .triangle{border-right-color:#444}.nanoGuidance .triangleBorder{display:none}\n.guidance-selected{-webkit-animation-name:guide-selected-animation;-webkit-animation-duration:.8s;-webkit-animation-timing-function:ease-in;-webkit-animation-direction:normal;-webkit-animation-fill-mode:forwards;-webkit-animation-iteration-count:2;animation-name:guide-selected-animation;animation-duration:.8s;animation-timing-function:ease-in;animation-direction:normal;animation-fill-mode:forwards;animation-iteration-count:2}\n@keyframes guide-selected-animation{from{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1)}\n50%{-webkit-transform:scale3d(1.05,1.05,1.05);transform:scale3d(1.05,1.05,1.05)}\nto{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1)}}@-webkit-keyframes guide-selected-animation{from{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1)}\n50%{-webkit-transform:scale3d(1.05,1.05,1.05);transform:scale3d(1.05,1.05,1.05)}\nto{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1)}}.guidance-fade-in{opacity:0;-webkit-animation:guide-selected-fadeIn ease-in 1;-moz-animation:guide-selected-fadeIn ease-in 1;animation:guide-selected-fadeIn ease-in 1;-webkit-animation-fill-mode:forwards;-moz-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-duration:1s;-moz-animation-duration:1s;animation-duration:1s}\n@-webkit-keyframes guide-selected-fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes guide-selected-fadeIn{from{opacity:0}\nto{opacity:1}}@keyframes guide-selected-fadeIn{from{opacity:0}to{opacity:1}\n}.nanoGuidance.light{background:#fff;border-color:1px solid #aaa;width:355px;max-width:355px;box-sizing:border-box;padding:0;padding-top:23px}\n.nanoGuidance.light .currentText{min-height:0;padding-bottom:32px;padding-right:23px;margin-bottom:0;padding-left:23px;overflow:hidden}\n.nanoGuidance.light .currentText h3{margin-top:0;margin-bottom:23px;padding:0;background-color:inherit;font-size:26px;line-height:normal;font-weight:300;font-family:inherit;overflow:hidden}\n.nanoGuidance.light .currentText p{margin:0;font-size:16px;font-family:inherit;word-break:break-all}\n.nanoGuidance.light .stepsInidicator{height:35px;position:static;position:relative;border-top:1px solid #ccc;bottom:0;box-shadow:inset 0 4px 6px -5px rgba(0,0,0,0.5)}\n.nanoGuidance.light .stepsPoint{display:none}.nanoGuidance.light a.next{font-size:0;background:url(//eu1-1.nanorep.com/common/guidance/images/arrow_right.png) no-repeat 9px 3px;width:24px;height:24px;border-radius:12px;right:20px;bottom:5px;position:absolute}\n.nanoGuidance.light a.prev{font-size:0;background:url(//eu1-1.nanorep.com/common/guidance/images/arrow_left.png) no-repeat 7px 3px;width:24px;height:24px;border-radius:12px;left:20px;bottom:5px;position:absolute}\n.nanoGuidance.light a.prev:active,.nanoGuidance.light a.next:active{box-shadow:inset 1px 1px 2px #777}\n.nanoGuidance.light .triangle{border:20px solid rgba(0,0,0,0)}.nanoGuidance.light .triangleBorder{display:block;border:20px solid rgba(0,0,0,0)}\n.nanoGuidance.light.positionRight .triangle{top:calc(50% - 27px);left:-35px;border-right:16px solid #fff}\n.nanoGuidance.light.positionRight .triangleBorder{top:calc(50% - 27px);left:-37px;border-right:16px solid #ccc}\n.nanoGuidance.light.positionLeft .triangle{top:calc(50% - 27px);right:-35px;border-left:16px solid #fff}\n.nanoGuidance.light.positionLeft .triangleBorder{top:calc(50% - 27px);right:-37px;border-left:16px solid #ccc}\n.nanoGuidance.light.positionBottom .triangle{left:calc(50% - 20px);top:-35px;border-bottom:16px solid #ccc}\n.nanoGuidance.light.positionBottom .triangleBorder{left:calc(50% - 20px);top:-37px;border-bottom:16px solid #ccc}\n.nanoGuidance.light.positionAbove .triangle{left:calc(50% - 20px);bottom:-35px;border-top:16px solid #ccc}\n.nanoGuidance.light.positionAbove .triangleBorder{left:calc(50% - 20px);bottom:- 37px;border-top:16px solid #ccc}\n.nanoGuidance.light .stopGuide{background:url(//eu1-1.nanorep.com/common/guidance/images/closeIcon.png) no-repeat 1px 1px;font-size:0;color:transparent;width:12px;height:12px}\n.nanoGuidance.light a.feedback{width:25px;height:25px;display:block;text-align:center;cursor:pointer;position:absolute;bottom:3px}\n.nanoGuidance.light a.feedback.like{background:url(//eu1-1.nanorep.com/common/guidance/images/guide-like.png) no-repeat 0 0;right:58px}\n.nanoGuidance.light a.feedback.dislike{background:url(//eu1-1.nanorep.com/common/guidance/images/dislike-guide.png) no-repeat 0 0;right:19px}\n.nanoGuidance.light a.feedback.like.selected{background:url(//eu1-1.nanorep.com/common/guidance/images/like_ac.png) no-repeat 0 0}\n.nanoGuidance.light a.feedback.dislike.selected{background:url(//eu1-1.nanorep.com/common/guidance/images/dislike_ac.png) no-repeat 0 0}\n.nanoGuidance.light .thanks_text.question{color:#888;font-size:14px}.nanoGuidance.light .thanks_text{color:#08c9c6;font-family:'Open Sans';text-align:right;position:absolute;top:13px;right:97px;font-size:16px;height:20px}"},init:function(container,data,utils){utils.addStyle(data.css);
(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}var getTime=(function(){if(typeof(Date.now)==="function"){return function(){return Date.now()}}else{return function(){return new Date().getTime()}}})();if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}}());if(!window.nanoGuidance){window.nanoGuidance=(function(){var nanoGuidance=function(options){this.ctor(options)};nanoGuidance.instances={};nanoGuidance.playGuide=function(guideId,step,force){var guide=nanoGuidance.instances[guideId];if(!guide){return}if(step==="last"){guide.startGuide(guide.steps.length-1,force)}else{guide.startGuide(step||0,force)}};nanoGuidance.stopGuide=function(guideId){if(typeof nanoGuidance.instances[guideId]!=="undefined"){nanoGuidance.instances[guideId].stopGuide()}};nanoGuidance.playGuideByElement=function(element){var p=element;while(p&&p!==document.body){if(typeof(p.className)==="string"&&p.className.indexOf("guidance-entry-point")!==-1){setTimeout(function(){nanoGuidance.playGuide(p.guideId,p.guideStepId,true)},0);return true}p=p.parentNode}return false};nanoGuidance.nextStep=function(guideId){var guide=nanoGuidance.instances[guideId];if(!guide){return}guide.nextStep()};nanoGuidance.getEntryPoint=function(element){var p=element;while(p&&p!==document.body){if(typeof(p.className)==="string"&&p.className.indexOf("guidance-entry-point")!==-1){return p}p=p.parentNode}return null};var CLASS_ENTRY_POINT="guidance-entry-point";function checkVariableValue(name,value){try{return eval(name)===value
}catch(e){return false}}var isIE=(function ie(){var ua=window.navigator.userAgent;var msie=ua.indexOf("MSIE ");if(msie>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){return true}else{return false}})();nanoGuidance.prototype.ctor=function(options){var self=this;this.id=options.id;nanoGuidance.instances[this.id]=this;var defaults={position:"bottom",margin:30,showOverlay:false,overlayPadding:0,showNextButton:true,showStopButton:true};this.options=this.inheriteConfig(options,defaults);this.scrollTo=options.scrollTo||window.scrollTo.bind(window);if(!this.options.disableScrollLock&&!options.scrollTo){this.scrollTo=Scroll.moveTo}this.steps=options.steps;for(var i=0;i<this.steps.length;++i){var step=this.steps[i];for(var j=0;j<step.ui.length;++j){var ui=step.ui[j];if(!ui.entryPoint){continue}var el;if(ui.entryPoint===true){el=this.getElement(ui.element)}else{el=this.getElement(ui.entryPoint)}if(!el){continue}this.addClass(el,CLASS_ENTRY_POINT);el.guideId=this.id;el.guideStepId=i}}this.addListener(window,"resize",function(){self.resize()});this.storage=this.getStorage();this.uiElements=[];this.uiConfigs=[];this.overlays=[];this.startListeners=[];this.conditionListeners=[];this.blurredElement=[];this.stepAllowedPositions={};this.running=false;this.events={};this.showStopButton=false;this.showPrevButton=false;this.showNextButton=false;this.waitElementTime=options.waitElementTime||3000;this.pollElementTime=options.pollElementTime||500;this.currentStep=-1;var nextStepSession=this.storage.getItem("runNextStep");if(nextStepSession){this.activateScheduledStep(nextStepSession)}var reloadStepSession=this.storage.getItem("reloadStep");if(reloadStepSession){this.activateReloadedStep(reloadStepSession)}var runGuideSession=this.storage.getItem("runGuide");if(runGuideSession){this.checkRunGuideSession(runGuideSession)}if(options.autoStart&&options.autoStart.length){for(var i=0;i<options.autoStart.length;i++){if(!this.running||options.autoStart[i].repeating){this.addAutoStartRule(options.autoStart[i])}}}};nanoGuidance.prototype.on=function(name,callback){var evt=this.events[name];
if(!evt){evt=this.events[name]=[]}evt.push(callback)};nanoGuidance.prototype.off=function(name,callback){var evt=this.events[name];if(!evt){return}for(var i=0;i<evt.length;++i){if(evt[i]!==callback){continue}evt.splice(i,1);return}};nanoGuidance.prototype.emit=function(name){var evt=this.events[name];if(!evt||!evt.length){return}var evtArgs=[];for(var i=1;i<arguments.length;++i){evtArgs.push(arguments[i])}for(var i=0;i<evt.length;++i){evt[i].apply(null,evtArgs)}};nanoGuidance.prototype.startGuide=function(step,force){if(this.running){return}this.running=true;if(!this.options.disableScrollLock){Scroll.block()}this.emit("before.start");this.updateStepsVisibility();this.clearAutoStartListeners();this.startKeyHandling();this.runStep(step||0,null,force);this.emit("start")};nanoGuidance.prototype.stopGuide=function(){if(!this.running){return}this.running=false;if(!this.options.disableScrollLock){Scroll.unblock()}this.hideAll();this.clearConditionListeners();this.stopKeyHandling();this.stopElementWaiting();this.emit("stop")};nanoGuidance.prototype.startKeyHandling=function(){var self=this;var callback=this.keyHandling=function(e){e=window.event||e;if(!e){return}var keyCode=e.which||e.keyCode;switch(keyCode){case 39:if(self.showNextButton){self.nextStep()}break;case 27:if(self.showStopButton){self.stopGuide()}break;case 37:if(self.showPrevButton){self.previousStep()}break}};this.addListener(window,"keyup",callback)};nanoGuidance.prototype.stopKeyHandling=function(){this.removeListener(window,"keyup",this.keyHandling)};nanoGuidance.prototype.addAutoStartRule=function(rule){var callback=function(){this.startGuide()}.bind(this);switch(rule.type){case"elementClick":this.addClickCondition(rule,callback,this.startListeners);break;case"elementValue":this.addValueCondition(rule,callback,this.startListeners);break;case"scrollPage":this.addScrollCondition(rule,callback,this.startListeners);break;case"variableValue":this.addVariableCondition(rule,callback,this.startListeners);break;case"onload":this.addListener(window,"load",callback);
break;case"idleTime":this.autoStartByIdle(rule);break}};nanoGuidance.prototype.addStepCondition=function(conditionOptions,nextStepOptionsId,customCallback){if(!customCallback){var callback=function(){this.runNextStepTarget(nextStepOptionsId)}.bind(this)}else{var callback=customCallback}switch(conditionOptions.type){case"elementClick":this.addClickCondition(conditionOptions,callback,this.conditionListeners);break;case"elementValue":this.addValueCondition(conditionOptions,callback,this.conditionListeners);break;case"scrollPage":this.addScrollCondition(conditionOptions,callback,this.conditionListeners);break;case"variableValue":this.addVariableCondition(conditionOptions,callback,this.conditionListeners);break;case"currentUrl":this.addUrlCondition(conditionOptions,nextStepOptionsId);break}if(conditionOptions.type=="and"){var conditionsDone=[];var conditionsLen=conditionOptions.conditions.length;for(var i=0;i<conditionOptions.conditions.length;i++){conditionsDone.push(false);(function(num){this.addStepCondition(conditionOptions.conditions[i],nextStepOptionsId,function(){conditionsDone[num]=true;var allDone=true;for(var n=0;n<conditionsDone.length;n++){if(conditionsDone[n]==false){allDone=false;break}}if(allDone){this.runNextStepTarget(nextStepOptionsId)}}.bind(this))}.bind(this)(i))}}};nanoGuidance.prototype.addScrollCondition=function(options,callback,listersList){var value=options.value;this.addRemovableListener({el:window,eventName:"scroll",callback:function(e){if(value<=window.scrollY){callback()}}},listersList)};nanoGuidance.prototype.addClickCondition=function(conditionOptions,callback,listersList){var repeating=conditionOptions.repeating||false;this.addRemovableListener({repeating:repeating,el:window,eventName:"click",onCapture:true,callback:function(e){var element=this.getElement(conditionOptions.id);var target=e.target;while(target.parentNode){if(target===element){callback();break}target=target.parentNode}}.bind(this)},listersList)};nanoGuidance.prototype.addValueCondition=function(conditionOptions,callback,listersList){var element=this.getElement(conditionOptions.id);
if(!element){return}var value=conditionOptions.value;var tag=element.tagName.toLowerCase();if(tag==="input"&&element.type==="text"){this.addRemovableListener({el:element,eventName:"change",callback:function(e){if(e.srcElement.value==value){callback()}}},listersList);this.addRemovableListener({el:element,eventName:"keyup",callback:function(e){if(e.srcElement.value==value){callback()}}},listersList)}else{if(tag==="input"&&element.type==="radio"){var radios=document.getElementsByName(element.name);for(var i=0;i<radios.length;i++){if(radios[i].type!=="radio"||radios[i].value!==value){continue}this.addRemovableListener({el:radios[i],eventName:"change",callback:function(e){callback()}},listersList);break}}else{if(tag==="select"){this.addRemovableListener({el:element,eventName:"change",callback:function(e){if(e.srcElement.value===value||value==="##anyValue"){callback()}}},listersList)}}}};nanoGuidance.prototype.addVariableCondition=function(conditionOptions,callback,listersList){var name=conditionOptions.name;var value=conditionOptions.value;var timeout=conditionOptions.timeout||0;var timeoutObj=null;var timerHandler=function(){if(checkVariableValue(conditionOptions.name,conditionOptions.value)){clearInterval(timeoutObj);callback();return true}return false};if(!timerHandler()&&timeout>0){timeoutObj=setInterval(timerHandler,timeout)}};nanoGuidance.prototype.addUrlCondition=function(conditionOptions,nextStepOptionsId){var url=conditionOptions;var str="step="+this.currentStep+"#nextStepOptionsId="+nextStepOptionsId;this.storage.setItem("runNextStep",str)};nanoGuidance.prototype.autoStartByIdle=function(options){this.startTimeout=setTimeout(function(){this.startGuide()}.bind(this),options.value);var callback=function(){clearTimeout(this.startTimeout);this.startTimeout=setTimeout(function(){this.startGuide()}.bind(this),options.value)}.bind(this);var interruptEvents=options.without.split(",");for(var i=0;i<interruptEvents.length;i++){this.addRemovableListener({el:document.body,eventName:interruptEvents[i],callback:callback},this.startListeners)
}};nanoGuidance.prototype.addRemovableListener=function(listener,listersList){listersList.push(listener);this.addListener(listener.el,listener.eventName,listener.callback,listener.onCapture||false)};nanoGuidance.prototype.checkRunGuideSession=function(sessionStr){var settings=this.parseSettings(sessionStr);if(settings.guide==this.id){this.storage.removeItem("runGuide");var step=settings.step||0;step=parseInt(step,10);this.ignoreRedirectBeforeStep=true;this.startGuide(step);return true}};nanoGuidance.prototype.activateReloadedStep=function(nextStepSession){var settings=this.parseSettings(nextStepSession);this.runStep(settings.step);this.storage.removeItem("reloadStep")};nanoGuidance.prototype.activateScheduledStep=function(nextStepSession){var settings=this.parseSettings(nextStepSession);var previousStep=this.steps[settings.step];var nextStepConfig=previousStep.nextStep[settings.nextStepOptionsId];var currentUrl;for(var c=0;c<nextStepConfig.conditions.length;c++){if(nextStepConfig.conditions[c].type==="currentUrl"){var checkUrl=nextStepConfig.conditions[c].url.toLowerCase();var urlMatched=false;if(checkUrl.charAt(0)==="%"){var currentPath=window.location.pathname.toLowerCase();checkUrl=checkUrl.substr(1);if(currentPath.substr(-checkUrl.length)===checkUrl){urlMatched=true}}else{if(currentUrl==(window.location+"").toLowerCase()){urlMatched=true}}if(urlMatched){var nextStepId=parseInt(nextStepConfig.target.id,10);this.runStep(nextStepId,true);return true}}}return false};nanoGuidance.prototype.updateStepsVisibility=function(){var step;for(var i=0;i<this.steps.length;i++){var hidden=false;step=this.steps[i];if(step.visibility){for(var j=0;j<step.visibility.length;j++){if(!this.checkVisibilityRule(step.visibility[j],step)){hidden=true;break}}}step.hidden=hidden}};nanoGuidance.prototype.checkVisibilityRule=function(rule,stepConfig){switch(rule.type){case"variableValue":return checkVariableValue(rule.name,rule.value);case"url":if(rule.include){return this.matchUrls(rule.include)}else{if(rule.exclude){return !this.matchUrls(rule.exclude)
}}break;case"callback":return this.runCallback(rule.callback,stepConfig)}return true};nanoGuidance.prototype.matchUrls=function(urlRules){var matched=false;if(typeof(urlRules)==="string"){urlRules=[urlRules]}for(var i=0;i<urlRules.length;i++){if(this.matchUrl(urlRules[i])){matched=true;break}}return matched};nanoGuidance.prototype.matchUrl=function(urlRule){var currentUrl=(window.location.origin+window.location.pathname).toLowerCase();var position;if(urlRule.charAt(0)==="%"){urlRule=urlRule.substr(1).toLowerCase();position=currentUrl.length-urlRule.length;var lastIndex=currentUrl.indexOf(urlRule,position);return lastIndex!==-1&&lastIndex===position}else{urlRule=urlRule.toLowerCase();return urlRule===currentUrl}};nanoGuidance.prototype.runStep=function(stepNumber,scheduled,force){this.emit("beforeRunStep",stepNumber);var stepConfig=this.steps[stepNumber];if(stepConfig===undefined){this.stopGuide();this.emit("completed");return}if(stepConfig.hidden&&!force){this.runStep(stepNumber+1);return}var previousStep=this.currentStep;this.currentStep=stepNumber;if(stepConfig.beforeShow){if(this.beforeShowStep(stepConfig)){this.stopGuide();return}}if(this.options.skipStepsWithNoElement&&!this.stepElementVisible(stepConfig)){if(this.intervalRunning){return false}if(!this.elementNotAppear&&this.waitElementTime){this.stepDirection=previousStep<stepNumber?"next":"prev";this.hideAll();var self=this;self.waitForElementIntr=setInterval(function(){var success=self.runStep(stepNumber,scheduled,force);if(success){self.stopElementWaiting()}},this.pollElementTime);self.waitForElementTimeout=setTimeout(function(){self.elementNotAppear=true;clearInterval(self.waitForElementIntr);self.intervalRunning=false;self.runStep(stepNumber,scheduled,force)},this.waitElementTime);this.intervalRunning=true;return false}if(this.stepDirection=="next"){this.nextStep(stepNumber)}else{this.previousStep(stepNumber)}return}this.running=true;this.stopElementWaiting();this.updateStepsVisibility();this.ignoreRedirectBeforeStep=false;var elements=this.drawStep(stepConfig);
this.emit("stepRun",elements,stepConfig.id,this.id);for(var i=0;i<this.uiElements.length;++i){var activePointer=this.uiElements[i].querySelector(".stepsPoint.active");if(activePointer){this.removeClass(activePointer,"active")}var allPointers=this.uiElements[i].querySelectorAll(".stepsPoint");if(!allPointers.length){continue}this.addClass(allPointers[stepNumber],"active")}if(!scheduled){this.storage.removeItem("runNextStep")}this.reloadStepCondition(stepConfig);return true};nanoGuidance.prototype.reloadStepCondition=function(stepConfig){this.clearConditionListeners();if(stepConfig.nextStep&&stepConfig.nextStep.length>0){for(var i=0;i<stepConfig.nextStep.length;i++){if(stepConfig.nextStep[i].conditions){for(var j=0;j<stepConfig.nextStep[i].conditions.length;j++){var condition=stepConfig.nextStep[i].conditions[j];this.addStepCondition(condition,i)}}}}};nanoGuidance.prototype.stopElementWaiting=function(){clearInterval(this.waitForElementIntr);clearTimeout(this.waitForElementTimeout);this.intervalRunning=false;this.elementNotAppear=false};nanoGuidance.prototype.drawStep=function(stepConfig){this.clearUiElements();this.currentStepConfig=stepConfig;var uiPositions=[];var elements=[];this.showStopButton=false;this.showNextButton=false;this.showPrevButton=false;var pos;if(stepConfig.ui&&stepConfig.ui.length>0){for(var i=0;i<stepConfig.ui.length;i++){var uiConfig=this.inheriteConfig(stepConfig.ui[i],this.options.uiDefaults);uiConfig=this.inheriteConfig(uiConfig,stepConfig);pos=this.showStepElement(uiConfig);uiPositions.push({position:pos,config:uiConfig});var elem=this.getElement(uiConfig.element);if(elem){elements.push(elem)}}}else{pos=this.showStepElement(stepConfig,this.options.uiDefaults);uiPositions.push({position:pos,config:stepConfig})}for(var i=0;i<elements.length;i++){this.blur(elements[i])}this.buildOverlay(uiPositions,null,stepConfig.overlayColor);return elements};nanoGuidance.prototype.stepElementVisible=function(stepConfig){var elName,el,rect,w,h;for(var i=0;i<stepConfig.ui.length;i++){elName=stepConfig.ui[i].element;
el=this.getElement(elName);if(!elName||!el){return false}rect=el.getBoundingClientRect();w=rect.width||el.clientWidth;h=rect.height||el.clientHeight;if(w==0||h==0){return false}if(rect.left<0||rect.left>window.innerWidth){return false}if(el.style.display=="none"||(typeof el.style.opacity!=="undefined"&&el.style.opacity===0)||el.style.visibility=="hidden"){return false}}return true};nanoGuidance.prototype.inheriteConfig=function(config,defaults){for(var prop in defaults){if(typeof defaults[prop]!=="object"){if(typeof config[prop]==="undefined"){config[prop]=defaults[prop]}}}return config};nanoGuidance.prototype.beforeShowStep=function(stepConfig){var stop;for(var i=0;i<stepConfig.beforeShow.length;i++){stop=this.applyAction(stepConfig.beforeShow[i],stepConfig);if(stop){return true}}return false};nanoGuidance.prototype.applyAction=function(action,stepConfig){switch(action.type){case"redirect":if(this.ignoreRedirectBeforeStep){return false}var url=this.parseUrlRule(action.url);if(this.options.onActionRedirect){return this.options.onActionRedirect(url)}var currentUrl=(window.location.origin+window.location.pathname);if(url.toLowerCase()===currentUrl.toLowerCase()){return false}var str="guide="+this.id+"#step="+this.currentStep;this.storage.setItem("runGuide",str);window.location.href=url;return true;case"callback":if(this.runCallback(action.callback,stepConfig)===false){return true}break}return false};nanoGuidance.prototype.runCallback=function(callback,stepConfig){if(typeof(callback)==="function"){return callback(stepConfig)}else{if(typeof window[callback]!=="undefined"){return window[callback](stepConfig)}}};nanoGuidance.prototype.parseUrlRule=function(checkUrl){if(checkUrl.charAt(0)==="%"){var newPath="";checkUrl=checkUrl.substr(1);var currentPath=window.location.pathname.toLowerCase();var pathElements=currentPath.split("/");if(pathElements.length){pathElements[pathElements.length-1]=checkUrl;newPath=pathElements.join("/");newPath=newPath.replace("//","/")}else{newPath=currentPath+checkUrl}return window.location.origin+newPath
}else{return checkUrl}};nanoGuidance.prototype.mergeUITemplate=function(childNodes,config){for(var i=0;i<childNodes.length;++i){var childN=childNodes[i];if(childN.nodeName.indexOf("#")===0){continue}switch(childN.nodeName){case"ARROW":var triangle=document.createElement("div");config.style.arrow.css+=";"+(childN.style.cssText||"");this.addClass(config.style.arrow,(childN.className||""));this.applyStyleToElement(triangle,config.style.arrow);childN.parentNode.insertBefore(triangle,childN);var triangleShadow=document.createElement("div");this.applyStyleToElement(triangleShadow,config.style.arrowShadow);childN.parentNode.insertBefore(triangleShadow,childN);childN.parentNode.removeChild(childN);break;case"STOP":var stop=document.createElement("div");stop.innerHTML="&#10060;";config.style.stopButton.css+=";"+(childN.style.cssText||"");this.addClass(config.style.stopButton,(childN.className||""));this.applyStyleToElement(stop,config.style.stopButton);childN.parentNode.replaceChild(stop,childN);break;case"TEXT":var textElement=document.createElement("div");textElement.innerHTML=config.text;config.style.text.css+=";"+(childN.style.cssText||"");this.addClass(config.style.text,(childN.className||""));this.applyStyleToElement(textElement,config.style.text);childN.parentNode.replaceChild(textElement,childN);break;case"STEPINDICATOR":config.style.stepPoint.css+=";"+(childN.style.cssText||"");this.addClass(config.style.stepPoint,(childN.className||""));for(var j=0;j<this.steps.length;j++){var stepPoint=document.createElement("div");this.applyStyleToElement(stepPoint,config.style.stepPoint);if(this.steps[j].hidden){stepPoint.style.display="none"}childN.parentNode.insertBefore(stepPoint,childN)}childN.parentNode.removeChild(childN);break;case"NEXT":var nextButton=document.createElement("A");nextButton.innerHTML=typeof(config.nextButtonText)==="string"?config.nextButtonText:(this.currentStep<this.steps.length-1)?"Next":"Close";config.style.nextButton.css+=(";"+(childN.style.cssText||""));this.addClass(config.style.nextButton,(childN.className||""));
this.applyStyleToElement(nextButton,config.style.nextButton);childN.parentNode.replaceChild(nextButton,childN);break;case"PREV":var prevButton=document.createElement("A");prevButton.innerHTML=typeof(config.prevButtonText)==="string"?config.prevButtonText:(this.currentStep<this.steps.length-1)?"Prev":"Close";config.style.prevButton.css+=(";"+(childN.style.cssText||""));this.addClass(config.style.prevButton,(childN.className||""));this.applyStyleToElement(prevButton,config.style.prevButton);childN.parentNode.replaceChild(prevButton,childN);break;default:this.mergeUITemplate(childN.childNodes,config);break}}};nanoGuidance.prototype.createUITemplate=function(config){var defaultStyles={container:{className:"nanoGuidance",css:""},arrow:{className:"triangle",css:""},arrowShadow:{className:"triangleBorder",css:""},nextButton:{className:"next",css:""},prevButton:{className:"prev",css:""},stopButton:{className:"stopGuide",css:""},steps:{className:"stepsInidicator",css:""},stepPoint:{className:"stepsPoint",css:""},text:{className:"currentText",css:""},likeButton:{className:"like feedback",css:""},dislikeButton:{className:"dislike feedback",css:""}};for(var i in defaultStyles){if(config.style&&config.style[i]){this.addClass(defaultStyles[i],(config.style[i].className||""));defaultStyles[i].css=(config.style[i].css||"")}}config.style=defaultStyles;var uiElement;if(config.template){uiElement=config.template.cloneNode(true);uiElement.id="";this.applyStyleToElement(uiElement,config.style.container);this.mergeUITemplate(uiElement.childNodes,config)}else{uiElement=document.createElement("div");this.applyStyleToElement(uiElement,config.style.container);var triangle=document.createElement("div");this.applyStyleToElement(triangle,config.style.arrow);uiElement.appendChild(triangle);var triangleShadow=document.createElement("div");this.applyStyleToElement(triangleShadow,config.style.arrowShadow);uiElement.appendChild(triangleShadow);var stop=document.createElement("div");stop.innerHTML="&#10060;";this.applyStyleToElement(stop,config.style.stopButton);
uiElement.appendChild(stop);var textElement=document.createElement("div");textElement.innerHTML=config.text;this.applyStyleToElement(textElement,config.style.text);uiElement.appendChild(textElement);this.emit("createTextElement",textElement,uiElement);var stepsIndicator=document.createElement("div");this.applyStyleToElement(stepsIndicator,config.style.steps);uiElement.appendChild(stepsIndicator);for(var i=0;i<this.steps.length;i++){var stepPoint=document.createElement("div");this.applyStyleToElement(stepPoint,config.style.stepPoint);if(this.steps[i].hidden){stepPoint.style.display="none"}stepsIndicator.appendChild(stepPoint)}var prevButton=document.createElement("A");prevButton.innerHTML="Back";this.applyStyleToElement(prevButton,config.style.prevButton);stepsIndicator.appendChild(prevButton);var nextButton=document.createElement("A");nextButton.innerHTML=(this.currentStep<this.steps.length-1)?"Next":"Close";this.applyStyleToElement(nextButton,config.style.nextButton);stepsIndicator.appendChild(nextButton);if(config.isFeedback){var likeButton=document.createElement("A");this.applyStyleToElement(likeButton,config.style.likeButton);stepsIndicator.appendChild(likeButton);var dislikeButton=document.createElement("A");this.applyStyleToElement(dislikeButton,config.style.dislikeButton);stepsIndicator.appendChild(dislikeButton);var text=document.createElement("span");text.className="thanks_text question";text.innerHTML="Please provide your feedback";stepsIndicator.appendChild(text)}var herbew=/[\u0590-\u05FF]+/;if(herbew.test(textElement.innerText)){textElement.style.direction="rtl";textElement.style.textAlign="right"}}document.body.appendChild(uiElement);return uiElement};nanoGuidance.prototype.applyStyleToElement=function(el,styleObject){if(styleObject.className){el.className+=" "+styleObject.className}if(styleObject.css){el.style.cssText+=";"+styleObject.css}};nanoGuidance.prototype.resize=function(){if(!this.running){return}var uiPositions=[];for(var i=0;i<this.uiElements.length;i++){var pos=this.placeToElement(this.uiElements[i],this.uiConfigs[i]);
uiPositions.push({position:pos,config:this.uiConfigs[i]})}var color=this.currentStepConfig?this.currentStepConfig.overlayColor:null;this.buildOverlay(uiPositions,this.currentStepConfig,color)};nanoGuidance.prototype.showStepElement=function(config){var self=this;var uiElement=this.createUITemplate(config);this.uiElements.push(uiElement);this.uiConfigs.push(config);var nextButton=uiElement.querySelector("a.next");if(nextButton){if(this.getUiProperty("showNextButton",config)){this.addListener(nextButton,"click",function(){self.nextStep()});this.showNextButton=true}else{nextButton.style.display="none"}}var stopButton=uiElement.querySelector("div.stopGuide");if(stopButton){if(this.getUiProperty("showStopButton",config)){this.addListener(stopButton,"click",function(){self.stopGuide()});this.showStopButton=true}else{stopButton.style.display="none"}}var likeButton=uiElement.querySelector("a.like");if(likeButton){this.addListener(likeButton,"click",function(){self.emit("like");self.showAfterFeedback(uiElement,likeButton);setTimeout(function(){self.stopGuide()},1500)})}var dislikeButton=uiElement.querySelector("a.dislike");if(dislikeButton){this.addListener(dislikeButton,"click",function(){self.emit("dislike");self.showAfterFeedback(uiElement,dislikeButton);setTimeout(function(){self.stopGuide()},1500)})}var prevButton=uiElement.querySelector("a.prev");if(prevButton){if(this.currentStep&&this.getUiProperty("showPrevButton",config)){this.addListener(prevButton,"click",function(){self.previousStep()});this.showPrevButton=true}else{prevButton.style.display="none"}}return this.placeToElement(uiElement,config)};nanoGuidance.prototype.showAfterFeedback=function(uiElement,button){this.addClass(button,"selected");var text=uiElement.querySelector(".thanks_text");text.innerHTML="Thank you!";text.className="thanks_text";var prevButton=uiElement.querySelector("a.prev");if(prevButton){prevButton.style.display="none"}};nanoGuidance.prototype.blur=function(element){if(element===document.body){return}var p=element.parentNode;for(var i=0;i<p.childNodes.length;
++i){var c=p.childNodes[i];if(c.nodeName.indexOf("#")===0){continue}if(c.nodeName==="IFRAME"&&c.className.indexOf("nanoGuidance")!==-1){continue}if(c.nodeName==="DIV"&&c.className.indexOf("nanoGuidance")!==-1){continue}if(c.className.indexOf("nanoGuidance-no-blur")!==-1){continue}if(c===element){this.unblur_element(c);this.addClass(c,"nanoGuidance-no-blur");continue}c.style.webkitFilter="blur(4px)";c.style.oFilter="blur(4px)";c.style.msFilter='progid:DXImageTransform.Microsoft.Blur(PixelRadius="4px")';c.style.msFilter="blur(4px)";c.style.mozFilter="blur(4px)";c.style.filter='progid:DXImageTransform.Microsoft.Blur(PixelRadius="4px")';c.style.filter="blur(4px)";c.style.pointerEvents="none";this.blurredElement.push(c)}this.blur(p)};nanoGuidance.prototype.unblur=function(){for(var i=0;i<this.blurredElement.length;++i){this.unblur_element(this.blurredElement[i])}this.blurredElement=[]};nanoGuidance.prototype.clear_nonblurred_elements=function(){var els=document.querySelectorAll(".nanoGuidance-no-blur");if(!els.length){return}for(var i=0;i<els.length;++i){this.removeClass(els[i],"nanoGuidance-no-blur")}};nanoGuidance.prototype.unblur_element=function(el){el.style.filter="";el.style.webkitFilter="";el.style.mozFilter="";el.style.oFilter="";el.style.msFilter="";el.style.pointerEvents=""};nanoGuidance.prototype.placeToElement=function(uiElement,config){this.emit("beforePlaceToElement");var body=document.body,html=document.documentElement;var documentWidth=Math.max(body.offsetWidth,html.clientWidth,html.offsetWidth);var documentHeight=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);uiElement.style.display="block";var el=this.getElement(config.element);if(!el||el===document.body){return this.placeStatic(uiElement,config)}var elType=el.getAttribute("type");if(el.nodeName=="INPUT"&&(elType=="text"||elType=="password"||elType=="email"||elType=="number"||elType=="tel")||el.nodeName=="TEXTAREA"){el.focus()}if(this.options.currentElementClass){this.addClass(el,this.options.currentElementClass)
}var rect=el.getBoundingClientRect();var popupHeight=uiElement.offsetHeight;var popupWidth=uiElement.offsetWidth;var left=0,newLeft;var top=0;var margin=this.getUiProperty("margin",config);var scroll=window.scrollY||document.body.scrollTop||document.documentElement.scrollTop;var winHeight=window.innerHeight;var elementCenter=scroll+rect.top+rect.height/2;var renderTime=0;var changed=false;var posNames={1:"left",2:"right",3:"bottom",4:"top"};var posArray={left:1,right:2,bottom:3,above:4,max:5,center:6};var popupPosition=posArray[this.getUiProperty("position",config)];var align=this.getUiProperty("align",config)||"middle";var offset=0;function isPositionValid(popupPosition,leftPos,topPos){if(popupPosition==posArray.max){return false}if(leftPos<0||leftPos+popupWidth+5>=documentWidth||topPos<0||(popupPosition===posArray.bottom&&topPos+popupHeight+5>=documentHeight)){return false}else{return true}}function getPosition(popupPosition){var top,left;switch(popupPosition){case 3:top=scroll+rect.top+rect.height+margin;if(rect.left<offset){offset=rect.left}left=rect.left-offset;switch(align){case"middle":left=(rect.left-offset)+(rect.width/2);left-=(popupWidth/2);if(left<0){left=0}break}break;case 4:top=scroll+rect.top-(popupHeight+margin);if(rect.left<offset){offset=rect.left}left=rect.left-offset;switch(align){case"middle":left=(rect.left-offset)+(rect.width/2);left-=(popupWidth/2);if(left<0){left=0}break}break;case 2:left=rect.left+rect.width+margin;switch(align){case"top":top=scroll+rect.top;break;case"middle":top=scroll+rect.top+(rect.height/2);top-=(popupHeight/2);break}break;case 1:left=rect.left-(popupWidth+margin)-offset;top=scroll+rect.top;switch(align){case"top":top=scroll+rect.top;break;case"middle":top=scroll+rect.top+(rect.height/2);top-=(popupHeight/2);break}break;case 6:left=(rect.left+(rect.width/2))-(popupWidth/2);top=scroll+rect.top+(rect.height/2)-(popupHeight/2);break}return{top:top,left:left}}var allowed={};var tmp;for(var position=1;position<=4;position++){tmp=getPosition(position);allowed[posNames[position]]=isPositionValid(position,tmp.left,tmp.top)
}this.stepAllowedPositions=allowed;while(true&&renderTime<50){var res=getPosition(popupPosition);top=res.top;left=res.left;if(!isPositionValid(popupPosition,left,top)){changed=true;if(++renderTime<posArray.max+1){if(popupPosition++===posArray.max){popupPosition=1}}else{var diff;var maxMovement=popupWidth*0.5;if(left>0){var desiredLeft=documentWidth-popupWidth-6;if(Math.abs(desiredLeft-left)<=maxMovement){offset=Math.abs(desiredLeft-left);continue}else{offset=maxMovement;diff=Math.ceil(left-desiredLeft+offset)}}else{if(left>-maxMovement){offset=left;continue}else{offset=maxMovement;diff=Math.ceil(left-desiredLeft+offset)}}uiElement.style.maxWidth="auto";uiElement.style.minWidth="auto";popupWidth-=diff;uiElement.style.width=popupWidth+"px"}}else{break}}this.popupPosition=posNames[popupPosition];if(changed){for(var i in posArray){if(posArray[i]!==popupPosition){continue}popupPosition=i;break}}this.setArrow(uiElement,config,changed?popupPosition:false);uiElement.style.left=left+"px";uiElement.style.top=top+"px";this.uiElementPosition={left:left,top:top,width:popupWidth,height:popupHeight};var partPopupOutOfView=top+popupHeight>scroll+winHeight||top<scroll;if(partPopupOutOfView||config.scrollTo){this.scrollTo(0,elementCenter-winHeight+winHeight/2,0)}this.emit("placeToElement",el);return{isFixed:false,top:scroll+rect.top,left:rect.left,width:rect.width,height:rect.height}};nanoGuidance.prototype.getAllowedPositions=function(){return this.stepAllowedPositions};nanoGuidance.prototype.setArrow=function(uiElement,config,arrowPosition){arrowPosition=arrowPosition||this.getUiProperty("arrow",config)||this.getUiProperty("position",config);var arrowClass="";var arrow=uiElement.querySelector(".triangle");var arrowBorder=uiElement.querySelector(".triangleBorder");var bgColor=this.getUiProperty("bgColor",config);var borderColor=this.getUiProperty("borderColor",config);function applyArrowColor(pos){arrow.style.borderLeftColor="transparent";arrow.style.borderTopColor="transparent";arrow.style.borderRightColor="transparent";arrow.style.borderBottomColor="transparent";
arrow.style["border"+pos+"Color"]=bgColor;arrowBorder.style.borderLeftColor="transparent";arrowBorder.style.borderTopColor="transparent";arrowBorder.style.borderRightColor="transparent";arrowBorder.style.borderBottomColor="transparent";arrowBorder.style["border"+pos+"Color"]=borderColor}switch(arrowPosition){case"bottom":arrowClass="positionBottom";applyArrowColor("Bottom");break;case"above":arrowClass="positionAbove";applyArrowColor("Top");break;case"right":arrowClass="positionRight";applyArrowColor("Right");break;case"left":arrowClass="positionLeft";applyArrowColor("Left");break;case"center":arrowClass="";break}this.removeClass(uiElement,"Bottom");this.removeClass(uiElement,"Top");this.removeClass(uiElement,"Right");this.removeClass(uiElement,"Left");if(arrowClass){this.addClass(uiElement,arrowClass)}};nanoGuidance.prototype.placeStatic=function(uiElement,config){var popupWidth=uiElement.offsetWidth;var popupHeight=uiElement.offsetHeight;this.addClass(uiElement,"fixed");uiElement.style.marginTop=-popupHeight/2+"px";uiElement.style.marginLeft=-popupWidth/2+"px";this.setArrow(uiElement,config,"center");this.blur(uiElement);this.emit("placeStatic");return{isFixed:true,top:0,left:0,width:0,height:0}};nanoGuidance.prototype.clearAutoStartListeners=function(){var listener;var newListeners=[];for(var i=0;i<this.startListeners.length;i++){listener=this.startListeners[i];if(!listener.repeating){this.removeListener(listener.el,listener.eventName,listener.callback)}else{newListeners.push(listener)}}this.startListeners=newListeners};nanoGuidance.prototype.clearConditionListeners=function(){var listener;for(var i=0;i<this.conditionListeners.length;i++){listener=this.conditionListeners[i];this.removeListener(listener.el,listener.eventName,listener.callback)}this.conditionListeners=[]};nanoGuidance.prototype.runNextStepTarget=function(nextStepOptionsId){this.clearConditionListeners();var nextStepConfig=this.currentStepConfig.nextStep[nextStepOptionsId];if(typeof nextStepConfig!=="undefined"){switch(nextStepConfig.target.type){case"step":var nextStepId=parseInt(nextStepConfig.target.id,10);
this.runStep(nextStepId);break;case"nextStep":this.nextStep();break;case"waitNextStep":this.emit("waitNextStep",this.currentStep+1);break;case"delayedStep":var nextStepId=parseInt(nextStepConfig.target.id,10);this.storage.removeItem("runNextStep");this.storage.setItem("reloadStep","step="+nextStepId);this.stopGuide();break}}};nanoGuidance.prototype.nextStep=function(step){if(typeof step=="undefined"){step=this.currentStep}this.emit("beforeNextStep");this.runStep(step+1);this.emit("nextStep")};nanoGuidance.prototype.previousStep=function(step){if(typeof step=="undefined"){step=this.currentStep}this.emit("beforePreviousStep");this.runStep(step-1);this.emit("previousStep")};nanoGuidance.prototype.addListener=function(Element,eventType,Method,onCapture){if(Element.addEventListener){if(eventType.indexOf("on")==0){eventType=eventType.charAt(2).toLowerCase()+eventType.slice(3)}Element.addEventListener(eventType,Method,onCapture)}else{if(Element.attachEvent){if(eventType.indexOf("on")!=0){eventType="on"+eventType}Element.attachEvent(eventType,Method)}}};nanoGuidance.prototype.removeListener=function(Element,eventType,Method){if(Element.removeEventListener){if(eventType.indexOf("on")==0){eventType=eventType.charAt(2).toLowerCase()+eventType.slice(3)}Element.removeEventListener(eventType,Method)}else{if(Element.detachEvent){if(eventType.indexOf("on")!=0){eventType="on"+eventType}Element.detachEvent(eventType,Method)}}};nanoGuidance.prototype.disableNextButton=function(){this.nextButton.style.display="none"};nanoGuidance.prototype.enableNextButton=function(){this.nextButton.style.display=""};nanoGuidance.prototype.getUiProperty=function(propName,ui){if(ui&&typeof ui[propName]!=="undefined"){return ui[propName]}else{if(typeof this.options[propName]!=="undefined"){return this.options[propName]}}return};nanoGuidance.prototype.buildOverlay=function(uiPositions,stepConfig,color){this.clearOverlays();var i;for(i=0;i<uiPositions.length;i++){if(uiPositions[i].config.showOverlay===true){break}}if(i==uiPositions.length){return}var body=document.body,html=document.documentElement;
var documentWidth=Math.max(body.scrollWidth,body.offsetWidth,html.clientWidth,html.scrollWidth,html.offsetWidth);var documentHeight=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);var pos,top,bottom;var horizontalGreed=[0,documentHeight];var verticalGreed=[];var pad,left,right,width;for(i=0;i<uiPositions.length;i++){pos=uiPositions[i].position;if(pos.isFixed){continue}pad=this.getUiProperty("overlayPadding",uiPositions[i].config);top=pos.top-pad;bottom=pos.top+pos.height+pad;horizontalGreed.push(top,bottom);left=pos.left-pad;right=pos.left+pos.width+pad;verticalGreed.push({top:top,bottom:bottom,left:left,right:right})}horizontalGreed.sort(function(a,b){return a-b});for(var i=0;i<horizontalGreed.length;i++){if(typeof horizontalGreed[i+1]==="undefined"){break}var rowTop=horizontalGreed[i];var rowHeight=horizontalGreed[i+1]-rowTop;var breakers=[];for(var j=0;j<verticalGreed.length;j++){var v=verticalGreed[j];if(rowTop+rowHeight>v.top&&rowTop+rowHeight<=v.bottom||rowTop>=v.top&&rowTop<v.bottom){breakers.push(v)}}if(breakers.length>0){var breakPoints=[0,documentWidth];for(var j=0;j<breakers.length;j++){breakPoints.push(breakers[j].left,breakers[j].right)}breakPoints.sort(function(a,b){return a-b});for(var b=0;b<breakPoints.length;b++){if(typeof breakPoints[b+1]=="undefined"){break}left=breakPoints[b];width=breakPoints[b+1]-left;var row=document.createElement("div");row.className="nanoGuidanceOverlay";if(isIE){row.className+=" ie"}row.style.top=rowTop+"px";row.style.height=rowHeight+"px";row.style.left=left+"px";row.style.width=width+"px";document.body.appendChild(row);if(color){row.style.backgroundColor=color}this.overlays.push(row);b++}}else{var row=document.createElement("div");row.className="nanoGuidanceOverlay";if(isIE){row.className+=" ie"}row.style.top=rowTop+"px";row.style.height=rowHeight+"px";document.body.appendChild(row);if(color){row.style.backgroundColor=color}this.overlays.push(row)}}};nanoGuidance.prototype.clearOverlays=function(){for(var i=0;i<this.overlays.length;
i++){document.body.removeChild(this.overlays[i])}this.overlays=[]};nanoGuidance.prototype.clearUiElements=function(){for(var i=0;i<this.uiElements.length;i++){document.body.removeChild(this.uiElements[i])}if(this.currentStepConfig){for(var i=0;i<this.currentStepConfig.ui.length;++i){var ui=this.currentStepConfig.ui[i];var el=this.getElement(ui.element);if(!el){continue}el.className=el.className.replace(" guidance-selected","");el.className=el.className.replace(" guidance-fade-in","");if(this.options.currentElementClass){this.removeClass(el,this.options.currentElementClass)}}}this.clear_nonblurred_elements();this.unblur();this.uiElements=[];this.uiConfigs=[]};nanoGuidance.prototype.hideAll=function(){this.clearUiElements();this.clearOverlays()};nanoGuidance.prototype.removeClass=function(e,className){if(!className){return}e.className=e.className.replace(className,"");e.className=e.className.replace(/\s\s+/g," ")};nanoGuidance.prototype.addClass=function(e,className){if(!className){return}this.removeClass(e,className);e.className=e.className+" "+className};nanoGuidance.prototype.createCookie=function(name,value,days){var expires;if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}else{expires=""}document.cookie=name+"="+value+expires+"; path=/"};nanoGuidance.prototype.getCookie=function(name){if(document.cookie.length>0){c_start=document.cookie.indexOf(name+"=");if(c_start!=-1){c_start=c_start+name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""};nanoGuidance.prototype.deleteCookie=function(name){var expires;var date=new Date();date.setTime(date.getTime()-(30*24*60*60*1000));expires="; expires="+date.toGMTString();document.cookie=name+"="+expires+"; path=/"};nanoGuidance.prototype.parseSettings=function(text){var settings={};var rows=text.split("#");for(var i=0;i<rows.length;i++){var row=rows[i].split("=");if(row.length==2){settings[row[0]]=row[1]
}else{}}return settings};nanoGuidance.prototype.getStorage=function(text){if(this.options.disableSession){return{setItem:function(){},getItem:function(){},removeItem:function(){}}}var test="nanoGuidance";try{window.localStorage.setItem(test,test);window.localStorage.removeItem(test);return window.localStorage}catch(e){return{setItem:this.createCookie,getItem:this.getCookie,removeItem:this.deleteCookie}}};nanoGuidance.prototype.getElement=function(selector){if(typeof(selector)==="function"){return selector()}if(typeof(selector)==="object"){return selector}else{return document.querySelector(selector)}};var Scroll={blockAnimFrameRequestId:null,block:function(left,top){var lockedScrollTop=isNaN(top)?window.pageYOffset:top;var lockedScrollLeft=isNaN(left)?window.pageXOffset:left;var revertScrollPosition=function(){var currentScrollTop=window.pageYOffset;var currentScrollLeft=window.pageXOffset;if(Scroll.isBlocked){if(currentScrollTop!==lockedScrollTop||currentScrollLeft!==lockedScrollLeft){window.scrollTo(lockedScrollLeft,lockedScrollTop)}Scroll.blockAnimFrameRequestId=requestAnimationFrame(revertScrollPosition)}};Scroll.isBlocked=true;revertScrollPosition()},unblock:function(){Scroll.isBlocked=false;if(Scroll.blockAnimFrameRequestId!==null){cancelAnimationFrame(Scroll.blockAnimFrameRequestId);Scroll.blockAnimFrameRequestId=null}},moveTo:function(desiredScrollLeft,desiredScrollTop,duration){var initialScrollTop=window.pageYOffset,initialScrollLeft=window.pageXOffset,startTime=Date.now();var blocked=Scroll.isBlocked;Scroll.unblock();Scroll.stopScrolling();var doScrollStep=function(){var currentTime=Date.now();var percent=Math.min((currentTime-startTime)/duration,1);var currentScrollTop=initialScrollTop+(desiredScrollTop-initialScrollTop)*percent;var currentScrollLeft=initialScrollTop+(desiredScrollLeft-initialScrollLeft)*percent;window.scrollTo(currentScrollLeft,currentScrollTop);if(percent<1){Scroll.timer=requestAnimationFrame(doScrollStep)}else{if(blocked){Scroll.block(desiredScrollLeft,desiredScrollTop)}}};doScrollStep()
},stopScrolling:function(){cancelAnimationFrame(Scroll.timer)}};return nanoGuidance})()}}});var GuidancePlayer=function(config){EventEmitter.call(this);this.config=config;this.player=null;this.isInit=false;this.updateTime=500;this.positionUpdateInterval=null};GuidancePlayer.prototype=Object.create(EventEmitter.prototype);GuidancePlayer.prototype.constructor=GuidancePlayer;GuidancePlayer.prototype.init=function(){this.addCss(".nanoGuidance {z-index:2000000000}")};GuidancePlayer.prototype.stop=function(){if(this.player){this.player.stopGuide()}this.active=false};GuidancePlayer.prototype.nextStep=function(){this.player.nextStep()};GuidancePlayer.prototype.playStep=function(guidance,step){this.play(guidance,guidance.steps.indexOf(step))};GuidancePlayer.prototype.reloadStep=function(step){this.addStepCss(step);var stepIndex=0;for(var i=0,l=this.currentGuide.steps.length;i<l;i++){if(this.currentGuide.steps[i].id===step.id){stepIndex=i;break}}var newStep=this.buildStepSettings(step,this.currentGuide.id);this.player.steps[stepIndex]=newStep;this.player.drawStep(newStep);this.player.reloadStepCondition(newStep)};GuidancePlayer.prototype.play=function(guidance,startFromStep){this.currentGuide=guidance;var steps=[];var step;for(var i=0;i<guidance.steps.length;i++){step=guidance.steps[i];if(step.element){steps.push(this.buildStepSettings(step,this.currentGuide.id))}}var showFeedback=guidance.options.permissions.feedback?true:false;if(showFeedback){var lastStep=steps[steps.length-1];lastStep.isFeedback=true;lastStep.ui[0].showNextButton=false}if(guidance.options.fontFamily=="Open Sans"){this.attachFont()}this.firstStep=true;this.firstLastStep=false;this.lastStepShown=false;this.isInit=true;this.stop();this.player=new nanoGuidance({id:"test",steps:steps,uiDefaults:{showOverlay:true,overlayPadding:1,showNextButton:true,showPrevButton:!!guidance.options.permissions.back,showStopButton:!!guidance.options.permissions.close,nextButtonText:"",prevButtonText:""},disableScrollLock:!!this.config.disableScrollLock,skipStepsWithNoElement:this.config.skipStepsWithNoElement||false,currentElementClass:this.config.currentElementClass,disableSession:true,onActionRedirect:onActionRedirect});
if(this.config.disableKeyHandling){this.player.startKeyHandling=function(){};this.player.stopKeyHandling=function(){}}this.isInit=false;var options=guidance.options;var self=this;function onStepShow(elements){if(self.stepAnimatedTimeout){clearTimeout(self.stepAnimatedTimeout)}self.stepAnimated=false;if(self.config.disableTransitionAnimation){return}var animated=false;var animationTime=1700;for(var i=0;i<elements.length;i++){var el=elements[i];if(guidance.options.animatedAs==="fade"){el.className+=" guidance-fade-in";animated=true}else{if(guidance.options.animatedAs==="bump"){el.className+=" guidance-selected";animated=true}}}if(animated){self.stepAnimated=true;self.stepAnimatedTimeout=setTimeout(function(){self.stepAnimated=false},animationTime)}}function onActionRedirect(url){var currentUrl=UrlHelper.getCurrentUrl();if(currentUrl.toLowerCase()==url.toLowerCase()){return false}else{var step=guidance.steps[self.player.currentStep===-1?0:self.player.currentStep];if(step&&step.options.usePartialUrlMatch&&currentUrl.indexOf(step.options.url)!==-1){return false}else{if(UrlHelper.getCurrentPath().toLowerCase()===UrlHelper.getUrlPath(url).toLowerCase()){window.location.hash=UrlHelper.getUrlHash(url);return false}}}self.emit("redirect",guidance,step);return true}this.player.on("waitNextStep",function(stepIndx){self.emit("waitNextStep",guidance,stepIndx)});this.player.on("stepRun",function(elements,stepId){var isLastStep=self.player.currentStep==guidance.steps.length-1;if(isLastStep&&!self.lastStepShown){self.lastStepShown=true;self.firstLastStep=true}else{self.firstLastStep=false}self.emit("stepRun",stepId,self.currentGuide.id);if(self.firstStep){self.firstStep=false}if(!elements||!elements.length){return}onStepShow(elements);var element=elements[0];self.runPositionUpdater(element)});this.player.on("beforeRunStep",function(stepIndex){var step=guidance.steps[stepIndex];if(step){self.addStepCss(step)}});this.player.on("placeToElement",function(el){self.emit("placeToElement")});this.player.on("stop",function(){var selected=document.querySelector(".guidance-fade-in");
if(selected){selected.className=selected.className.replace("guidance-fade-in","")}if(self.stepCssElement){self.stepCssElement.innerHTML=""}if(!self.isInit){self.emit("stop")}self.clearPositionUpdater()});this.player.on("like",function(){self.emit("feedback",self.currentGuide.id,true)});this.player.on("dislike",function(){self.emit("feedback",self.currentGuide.id,false)});this.player.on("beforeNextStep",function(){self.emit("beforeNextStep")});this.player.on("nextStep",function(){self.emit("nextStep")});this.player.on("beforePreviousStep",function(){self.emit("beforePreviousStep")});this.player.on("previousStep",function(){self.emit("previousStep")});this.player.on("createTextElement",function(textElement,uiElement){self.emit("createTextElement",textElement,uiElement)});this.player.startGuide(startFromStep);this.active=true};GuidancePlayer.prototype.buildStepSettings=function(step,guideId){var view={text:(step.name?"<h3>"+step.name+"</h3>":"")+(step.description?"<p>"+step.description+"</p>":""),position:step.options.position=="top"?"above":(step.options.position||undefined),style:{container:{className:"light",css:"border-radius:1px;border:1px solid "+step.options.borderColor+";background: "+step.options.bgColor+";"},text:{css:"color: "+step.options.textColor+";font-family: "+this.currentGuide.options.fontFamily+";"}},bgColor:step.options.bgColor,borderColor:step.options.borderColor};if(step.options.allowBack!==""){view.showPrevButton=step.options.allowBack}if(step.options.allowClose!==""){view.showStopButton=step.options.allowClose}if(step.options.nextStep=="click"){view.showNextButton=true}else{view.showNextButton=false}if(step.isFeedback){view.showNextButton=false}if(step.element){view.element=step.element}var stepSettings={ui:[view]};if(step.url){stepSettings.beforeShow=[{type:"redirect",url:step.url}]}if(step.options.nextStep=="element"){stepSettings.nextStep=[{conditions:[{type:"elementClick",id:step.element}],target:{type:"waitNextStep"}}];view.showNextButton=false}if(step.isFeedback){stepSettings.isFeedback=true
}if(this.currentGuide.options.highlightSteps==="blur"){stepSettings.overlayColor="transparent"}else{stepSettings.overlayColor=step.options.overlayColor?step.options.overlayColor:this.currentGuide.options.highlightSteps}if(step.id){stepSettings.id=step.id}return stepSettings};GuidancePlayer.prototype.addCss=function(css){var style=document.createElement("style");style.type="text/css";style.innerHTML=css;document.getElementsByTagName("head")[0].appendChild(style)};GuidancePlayer.prototype.addStepCss=function(step){var options=step.options;if(!this.stepCssElement){this.stepCssElement=document.createElement("style");this.stepCssElement.type="text/css";document.getElementsByTagName("head")[0].appendChild(this.stepCssElement)}var css="";if(options.computedCss){css+=options.computedCss}if(options.customCss){css+=options.customCss}this.stepCssElement.innerHTML=css};GuidancePlayer.prototype.getRect=function(){return this.player.uiElementPosition};GuidancePlayer.prototype.getAllowedPositions=function(){var positions=this.player.getAllowedPositions();if(!positions.hasOwnProperty("left")){return null}return positions};GuidancePlayer.prototype.getCurrentPosition=function(){return this.player.popupPosition};GuidancePlayer.prototype.attachFont=function(){if(document.querySelector("#googleFont_openSans")){return}var l=document.createElement("link");l.id="googleFont_openSans";l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href","//fonts.googleapis.com/css?family=Open+Sans");document.getElementsByTagName("head")[0].appendChild(l)};GuidancePlayer.prototype.runPositionUpdater=function(element){var self=this;var props=["left","top","height","width"];var propsLen=props.length;var i,rect,prop;this.prevStepRect=element.getBoundingClientRect();if(this.positionUpdateInterval){clearInterval(this.positionUpdateInterval)}this.positionUpdateInterval=setInterval(function(){if(self.stepAnimated){return}rect=element.getBoundingClientRect();if(!rect.width||!rect.height){self.prevStepRect={};return}for(i=0;i<propsLen;
i++){prop=props[i];if(rect[prop]!==self.prevStepRect[prop]){self.prevStepRect=rect;var scrollTo=self.player.scrollTo;self.player.scrollTo=function(){};self.player.resize();self.player.scrollTo=scrollTo;return}}},this.updateTime)};GuidancePlayer.prototype.clearPositionUpdater=function(){if(this.positionUpdateInterval!==null){clearInterval(this.positionUpdateInterval);this.positionUpdateInterval=null}};GuidancePlayer.prototype.highlightElement=function(el){var className=this.player.options.currentElementClass;var els=document.querySelectorAll("."+className);for(var i=0;i<els.length;i++){this.player.removeClass(els[i],className)}this.player.addClass(el,className);this.player.clear_nonblurred_elements();this.player.unblur();this.player.blur(el)};var EditorApi=function(config){this.config=config||{}};EditorApi.prototype.getAllGuidances=function(callback){this.sendRequest(Alloy.Com.enumMethod.GET,"getAllGuides",null,function(response){var guidances=[];var guidance;for(var i=0;i<response.length;i++){guidance=this.parseGuidanceData(response[i]);guidance.steps=[];for(var s=0;s<response[i].steps.length;s++){guidance.steps.push(this.parseStepData(response[i].steps[s]))}guidances.push(guidance)}callback(guidances)})};EditorApi.prototype.updateGuidance=function(guidance,callback){var data=this.prepareGuidanceData(guidance);this.sendRequest(Alloy.Com.enumMethod.POST,"updateGuide",data,function(){if(callback){callback()}})};EditorApi.prototype.insertGuidance=function(guidance,callback){var data=this.prepareGuidanceData(guidance);this.sendRequest(Alloy.Com.enumMethod.POST,"addGuide",data,function(response){callback({id:response.id})})};EditorApi.prototype.deleteGuidance=function(guidanceId,callback){var data={id:guidanceId};this.sendRequest(Alloy.Com.enumMethod.POST,"deleteGuide",data,callback)};EditorApi.prototype.insertStep=function(guidanceId,step,callback){var data={id:guidanceId,step:this.prepareStepData(step)};this.sendRequest(Alloy.Com.enumMethod.POST,"addStep",data,callback)};EditorApi.prototype.updateStep=function(guidanceId,step,callback){var data={id:guidanceId,step:this.prepareStepData(step)};
this.sendRequest(Alloy.Com.enumMethod.POST,"updateStep",data,callback)};EditorApi.prototype.deleteStep=function(guidanceId,stepId,callback){var data={id:guidanceId,step:{id:stepId}};this.sendRequest(Alloy.Com.enumMethod.POST,"deleteStep",data,callback)};EditorApi.prototype.repositionSteps=function(guidanceId,steps,callback){var data={id:guidanceId,steps:[]};for(var i=0;i<steps.length;i++){data.steps.push({id:steps[i].id})}this.sendRequest(Alloy.Com.enumMethod.POST,"reorderSteps",data,callback)};EditorApi.prototype.sendRequest=function(method,path,data,callback){var url=this.config.serverUrl+"/api/guidance/v1/"+path;url+="?sid="+this.config.sessionId;if(data){data=JSON.stringify(data)}var self=this;function handler(code,response){if(code===Alloy.Com.SUCCESS){if(method!==Alloy.Com.enumMethod.GET){response=JSON.parse(response)}if(callback){callback.call(self,response)}}else{console.log("Response error code: "+code)}}if(method===Alloy.Com.enumMethod.GET){Alloy.jsonp({url:url,params:data,handler:handler})}else{Alloy.ajax({method:method,url:url,handler:handler,data:data})}};EditorApi.prototype.prepareGuidanceData=function(guidance){var result={};if(guidance.id){result.id=guidance.id}result.name=guidance.name;result.playerProperties=guidance.options;result.journeyTrackingEnabled=false;result.playerProperties.isStopped=guidance.isStopped;result.journeyTrackingEnabled=guidance.options.taskCompletion;return result};EditorApi.prototype.parseGuidanceData=function(data){return{id:data.id,name:data.name,options:data.playerProperties,isStopped:data.playerProperties.isStopped}};EditorApi.prototype.prepareStepData=function(step){var result={};if(step.id){result.id=step.id}result.name=step.name;result.playerProperties=step.options;result.playerProperties.element=step.element;result.playerProperties.description=step.description;result.playerProperties.url=step.url;return result};EditorApi.prototype.parseStepData=function(data){return{id:data.id,name:data.name,options:data.playerProperties,element:data.playerProperties.element,description:data.playerProperties.description,url:data.playerProperties.url}
};function ViewerApi(config){this.config=config||{};this.timeout=config.timeout||10000;this.config.account=this.config.account.toLowerCase();this.setServerURL();this.requestId=new Date().getTime()}ViewerApi.prototype.parseGuidanceData=EditorApi.prototype.parseGuidanceData;ViewerApi.prototype.parseStepData=EditorApi.prototype.parseStepData;ViewerApi.prototype.requestJsonp=function(url,callback,params){var self=this;var cbName="_cb"+this.requestId++;window[cbName]=function(response){callback(response);clearTimeout(idleTimeout);self.removeScript(request)};var request=document.createElement("script");var requestUrl=this.config.serverUrl+url+"?cb="+cbName;if(params){for(var name in params){requestUrl+="&"+name+"="+params[name]}}var idleTimeout=setTimeout(function(){self.removeScript(request)},this.timeout);request.src=requestUrl;document.documentElement.appendChild(request)};ViewerApi.prototype.removeScript=function(script){if(script.parentNode){script.parentNode.removeChild(script)}};ViewerApi.prototype.setServerURL=function(){var isURL=this.config.serverUrl.indexOf("http:")===0||this.config.serverUrl.indexOf("https:")===0||this.config.serverUrl.indexOf("//")===0;if(!isURL){this.config.serverUrl="//"+this.config.serverUrl}};ViewerApi.prototype.getGuidances=function(callback){var self=this;this.requestJsonp("/api/guidance/v1/getAllGuidesWithoutSteps",function(response){callback(self.parseGuides(response))},{account:this.config.account})};ViewerApi.prototype.getGuideSteps=function(guideId,callback){var self=this;this.requestJsonp("/api/guidance/v1/getSteps",function(response){callback(self.parseSteps(response.steps))},{account:this.config.account,guideId:guideId})};ViewerApi.prototype.parseGuides=function(guides){var parsed=[];for(var i=0;i<guides.length;i++){parsed.push(this.parseGuidanceData(guides[i]))}return parsed};ViewerApi.prototype.parseSteps=function(steps){var parsed=[];for(var i=0;i<steps.length;i++){parsed.push(this.parseStepData(steps[i]))}return parsed};ViewerApi.prototype.getGuideCookies=function(cookiesName,callback){var params={};
for(var i=0;i<cookiesName.length;i++){params[cookiesName[i]]=""}this.requestJsonp("/api/cookies/v1/getCookies",function(response){var cookies={};var name;for(var i=0;i<cookiesName.length;i++){name=cookiesName[i];cookies[name]=response[name]||""}callback(cookies)},params)};ViewerApi.prototype.setGuideCookies=function(cookies,callback){this.requestJsonp("/api/cookies/v1/setCookies",function(){if(callback){callback("OK")}},cookies)};ViewerApi.prototype.clearGuideCookies=function(cookiesName,callback){var params={};for(var i=0;i<cookiesName.length;i++){params[cookiesName[i]]=""}this.requestJsonp("/api/cookies/v1/clearCookies",function(){if(callback){callback("OK")}},params)};ViewerApi.prototype.trackStep=function(stepId,guideId,isFirstStep,isFirstLastStep,articleId,kbId,domainId){var params={};params.guideId=guideId;params.stepId=stepId;params.isFirstTimeStep=isFirstStep;params.isFirstTimeLastStep=isFirstLastStep;if(articleId){params.articleId=articleId}if(kbId){params.viewId=kbId}if(domainId){params.domainId=domainId}this.requestJsonp("/api/guidance/v1/trackStep",function(){},params)};ViewerApi.prototype.trackFeedback=function(guideId,positive,articleId,kbId,domainId){var params={};params.guideId=guideId;params.isPositiveFeedback=positive;if(articleId){params.articleId=articleId}if(kbId){params.viewId=kbId}if(domainId){params.domainId=domainId}this.requestJsonp("/api/guidance/v1/reportFeedback",function(){},params)};var UrlHelper={};UrlHelper.isSameDomain=function(url_a,url_b){var reg=new RegExp(/^.*\/\/[^\/]+/i);var a=reg.exec(url_a);var b=reg.exec(url_b);if(a&&b&&a[0]==b[0]){return true}else{return false}};UrlHelper.getUrlHash=function(url){var reg=new RegExp(/\#.*$/i);var res=reg.exec(url);if(res&&res.length){return res[0]}else{return""}};UrlHelper.getCurrentHash=function(){return window.location.hash};UrlHelper.getUrlPath=function(url){var el=document.createElement("a");el.href=url;var hash=el.hash;var url=el.href.replace(hash,"");return url};UrlHelper.getCurrentPath=function(){var loc=window.location;var url=loc.origin+loc.pathname+loc.search;
return url};UrlHelper.getCurrentUrl=function(raw){return window.location.href};UrlHelper.toGoUrl=function(url){window.location.href=url};window.UrlHelper=UrlHelper;var savedGuidances;var scheduled;var startedFromArticle;var startedFromKb;var startedFromDomainId;window.addEventListener("message",function(event){if(!event||!event.data){return}if(event&&event.data==="toggleGuidanceEditor"){guidancePlayer.stop()}if(typeof event.data=="string"&&event.data.indexOf("runGuidance")>-1){var params={};var strings=event.data.split("&");for(var i=0;i<strings.length;i++){var s=strings[i].split("=");if(s.length>1){params[s[0]]=s[1]}}if(savedGuidances&&params.guideId){checkGuidances(savedGuidances,{guidanceId:params.guideId,stepId:params.stepId,articleId:params.articleId,kbId:params.viewId,domainId:params.domainId})}}});window.addEventListener("hashchange",function(event){if(savedGuidances){checkGuidances(savedGuidances,null)}});var guidancePlayer=new GuidancePlayer({serverUrl:serverUrl,skipStepsWithNoElement:true,disableScrollLock:true});guidancePlayer.init();guidancePlayer.on("redirect",function(guide,step){var url=step.url;if(scheduled&&scheduled.guidanceId==guide.id&&scheduled.stepId==step.id){return}var cookieContent=[guide.id,step.id].join(",");if(startedFromArticle){cookieContent+=","+startedFromArticle}if(startedFromKb){cookieContent+=","+startedFromKb}if(startedFromDomainId){cookieContent+=","+startedFromDomainId}guidancesApi.setGuideCookies({guideState:cookieContent});setTimeout(function(){UrlHelper.toGoUrl(url)},100)});guidancePlayer.on("waitNextStep",function(guide,stepIndx){if(stepIndx==0){return}if(stepIndx>guide.steps.length-1){return}var prevStep=guide.steps[stepIndx-1];var nextStep=guide.steps[stepIndx];if(prevStep.url==nextStep.url){guidancePlayer.nextStep();return}var cookieContent=[nextStep.url,guide.id,nextStep.id].join("|||");guidancesApi.setGuideCookies({waitForRedirect:cookieContent})});guidancePlayer.on("stepRun",function(stepId,guideId){guidancesApi.trackStep(stepId,guideId,guidancePlayer.firstStep,guidancePlayer.firstLastStep,startedFromArticle,startedFromKb,startedFromDomainId)
});guidancePlayer.on("feedback",function(guideId,positive){guidancesApi.trackFeedback(guideId,positive?true:false,startedFromArticle,startedFromKb,startedFromDomainId)});var guidancesApi=new ViewerApi({serverUrl:serverUrl,account:window.guidanceAccount});guidancesApi.getGuidances(function(guidances){savedGuidances=guidances;onGuidesLoad(savedGuidances);if(scheduled){checkGuidances(guidances,scheduled)}});getScheduledGuide(function(scheduledResponse){scheduled=scheduledResponse;if(savedGuidances){checkGuidances(savedGuidances,scheduled)}});function checkGuidances(guidances,scheduled){var guidance=null;var matchedGuides=[];var autoplayStepId=null;if(scheduled&&scheduled.guidanceId){for(var i=0;i<guidances.length;i++){if(scheduled.guidanceId==guidances[i].id){guidance=guidances[i];autoplayStepId=scheduled.stepId;if(scheduled.articleId){startedFromArticle=scheduled.articleId}if(scheduled.kbId){startedFromKb=scheduled.kbId}if(scheduled.domainId){startedFromDomainId=scheduled.domainId}break}}}if(!guidance){var currentPage=window.location.hostname+window.location.pathname;for(var i=0;i<guidances.length;i++){if(guidances[i].isStopped){continue}var urlMatched=false;if(guidances[i].options.urls){for(var j=0;j<guidances[i].options.urls.length;j++){var url=guidances[i].options.urls[j];if(url.indexOf(currentPage)!==-1){urlMatched=true;break}}}if(urlMatched){matchedGuides.push(guidances[i])}}}else{matchedGuides.push(guidance)}if(!matchedGuides.length){return}for(var i=0;i<matchedGuides.length;i++){guidance=matchedGuides[i];(function(guidance){if(!guidance.steps||guidance.steps.length==0){guidancesApi.getGuideSteps(guidance.id,function(steps){if(!steps){return}guidance.steps=steps;loadGuidance(guidance,autoplayStepId)})}else{loadGuidance(guidance,autoplayStepId)}})(guidance)}}function getScheduledGuide(callback){var scheduled={};guidancesApi.getGuideCookies(["waitForRedirect","guideState"],function(cookies){var cookie;if(cookies.waitForRedirect){cookie=cookies.waitForRedirect.split("|||");var url=cookie[0];if(url==UrlHelper.getCurrentUrl()){scheduled.guidanceId=cookie[1];
scheduled.stepId=cookie[2]}}else{if(cookies.guideState){cookie=cookies.guideState.split(",");scheduled.guidanceId=cookie[0];scheduled.stepId=cookie[1];if(cookie[2]){scheduled.articleId=cookie[2]}if(cookie[3]){scheduled.kbId=cookie[3]}if(cookie[4]){scheduled.domainId=cookie[4]}}}callback(scheduled)})}var cookiesCleared=false;function loadGuidance(guidance,autoplayStepId){if(!cookiesCleared){cookiesCleared=true;guidancesApi.clearGuideCookies(["waitForRedirect","guideState"])}if(autoplayStepId){var startStep=0;for(var i=0;i<guidance.steps.length;i++){if(guidance.steps[i].id==autoplayStepId){startStep=i;break}}scheduled={};guidancePlayer.play(guidance,startStep)}if(guidance.options.triggerAt&&guidance.options.triggerAt.button){var button=document.getElementById(guidance.options.buttonId);if(button){button.addEventListener("click",function(){guidancePlayer.play(guidance)})}}if(guidance.options.triggerAt&&guidance.options.triggerAt.firstVisit){if(guidance.steps[0].url!==UrlHelper.getCurrentUrl()){return}if(!isCurrentPageVisited()&&!guidancePlayer.active){guidancePlayer.play(guidance)}}}function isCurrentPageVisited(){if(document.cookie.indexOf("seenGuidance")===-1){document.cookie="seenGuidance=1";return false}return true}function onGuidesLoad(guides){window.GuidanceAPI.loadedGuides=guides;if(window.GuidanceAPI.onload){window.GuidanceAPI.onload(guides)}}if(!window.GuidanceAPI){window.GuidanceAPI={}}window.GuidanceAPI.getGuide=function(id){if(!savedGuidances){return null}var guide;for(var i=0;i<savedGuidances.length;i++){guide=savedGuidances[i];if(id==guide.id){return guide}}return null}})();